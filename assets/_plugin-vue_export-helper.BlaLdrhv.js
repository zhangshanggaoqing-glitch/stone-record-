import{L as t,r as e,c as a,M as n,N as i,P as r}from"./index-Cvve_R9O.js";function o(t){const e=t.filter(t=>"IN"===t.type).reduce((t,e)=>t+e.amount,0),a=t.filter(t=>"OUT"===t.type).reduce((t,e)=>t+e.amount,0),n=e-a;return{totalIn:e,totalOut:a,balance:Math.round(100*n)/100,unit:"mL"}}const l="STONE_RECORDS",u="STONE_CATEGORIES_V4",s="STONE_DAILY_LIMIT",c=["ðŸ¥£","ðŸ¥¤","ðŸµ","ðŸ¥›","ðŸ§´","ðŸ«™","ðŸ¥¡","ðŸ’§","ðŸ’¦","ðŸ©¸","ðŸ¥¥","ðŸ‹","ðŸ’‰","ðŸ’Š","ðŸ§ª","ðŸ©¹","ðŸ«","ðŸŒ¡ï¸"],d=[{id:"sys_diet",label:"é¥®é£Ÿ",type:"IN",icon:"ðŸ¥£",isDefault:!0},{id:"sys_water",label:"é¥®æ°´",type:"IN",icon:"ðŸ¥¤",isDefault:!0},{id:"sys_infusion",label:"è¾“æ¶²",type:"IN",icon:"ðŸ’‰",isDefault:!0},{id:"sys_blood",label:"è¾“è¡€",type:"IN",icon:"ðŸ©¸",isDefault:!0},{id:"sys_urine",label:"å°¿æ¶²",type:"OUT",icon:"ðŸ’§",isDefault:!0},{id:"sys_stool",label:"å¤§ä¾¿",type:"OUT",icon:"ðŸ’©",isDefault:!0},{id:"sys_vomit",label:"å‘•å",type:"OUT",icon:"ðŸ¤®",isDefault:!0},{id:"sys_sputum",label:"ç—°é‡",type:"OUT",icon:"ðŸ«",isDefault:!0},{id:"sys_drainage",label:"å¼•æµ",type:"OUT",icon:"ðŸ§´",isDefault:!0},{id:"sys_other_out",label:"å…¶ä»–æŽ’å‡º",type:"OUT",icon:"ðŸ“‰",isDefault:!0}],m=(t,e)=>{const a=new Date(t),n=new Date(e);return a.toDateString()===n.toDateString()},p=t("fluid",()=>{const t=e([]),c=e([]),p=e(Date.now()),f=e(2e3),y=a(()=>{const e=Date.now();return o(t.value.filter(t=>m(t.timestamp,e)))}),D=a(()=>{const t=y.value.totalIn,e=f.value>0?f.value:2e3;let a="safe";return t/e>=1?a="danger":t/e>=.8&&(a="warning"),{percent:Math.min(t/e*100,100),remaining:e-t,limit:e,level:a}}),v=a(()=>t.value.filter(t=>m(t.timestamp,p.value)).sort((t,e)=>e.timestamp-t.timestamp)),g=a(()=>o(v.value)),O=a(()=>{const e=[],a=new Date,n=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime(),i=864e5;for(let r=6;r>=0;r--){const a=n-r*i,o=a+i,l=t.value.filter(t=>t.timestamp>=a&&t.timestamp<o),u=l.filter(t=>"IN"===t.type).reduce((t,e)=>t+e.amount,0),s=l.filter(t=>"OUT"===t.type).reduce((t,e)=>t+e.amount,0),c=u-s,d=new Date(a),m=`${(d.getMonth()+1).toString().padStart(2,"0")}-${d.getDate().toString().padStart(2,"0")}`;e.push({date:m,timestamp:a,balance:Math.round(c),totalIn:Math.round(u),totalOut:Math.round(s)})}return e});function S(){n(l,JSON.stringify(t.value))}function I(){n(u,JSON.stringify(c.value))}return{recordList:t,categoryList:c,selectedDate:p,dailyLimit:f,realTimeBalance:y,limitStatus:D,currentDateReport:g,currentDateRecords:v,weeklyTrend:O,getCategoryById:t=>c.value.find(e=>e.id===t)||{id:"unknown",label:"æœªçŸ¥",type:"IN",icon:"â“",isDefault:!0},loadRecords:function(){try{const e=r(l),a=r(u),n=r(s);e&&(t.value=JSON.parse(e)),n&&(f.value=Number(n)),a&&"[]"!==a?c.value=JSON.parse(a):(c.value=[...d],I())}catch(e){console.error("Init failed",e)}},addRecord:function(e){t.value.push(e),S()},removeRecord:function(e){const a=t.value.findIndex(t=>t.id===e);-1!==a&&(t.value.splice(a,1),S())},addCustomCategory:function(t,e,a="âœ¨"){const n={id:`custom_${Date.now()}`,label:t,type:e,icon:a,isDefault:!1};return c.value.push(n),I(),n},removeCategory:function(t){const e=c.value.findIndex(e=>e.id===t);return-1!==e&&!c.value[e].isDefault&&(c.value.splice(e,1),I(),!0)},updateDailyLimit:function(t){f.value=t,n(s,t)},setDate:function(t){p.value=t},getReportData:function(e){const a=new Date,n=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59).getTime(),i=n-24*e*60*60*1e3+1,r=t.value.filter(t=>t.timestamp>=i&&t.timestamp<=n).sort((t,e)=>e.timestamp-t.timestamp),o=r.filter(t=>"IN"===t.type).reduce((t,e)=>t+e.amount,0),l=r.filter(t=>"OUT"===t.type).reduce((t,e)=>t+e.amount,0),u=o-l,s=e>0?Math.round(u/e):0,c={};r.forEach(t=>{const e=new Date(t.timestamp),a=`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`;c[a]||(c[a]=[]),c[a].push(t)});const d=Object.keys(c).sort((t,e)=>new Date(e).getTime()-new Date(t).getTime()).map(t=>{const e=c[t],a=e.filter(t=>"IN"===t.type).reduce((t,e)=>t+e.amount,0),n=e.filter(t=>"OUT"===t.type).reduce((t,e)=>t+e.amount,0);return{date:t,records:e,dailyIn:a,dailyOut:n,dailyBalance:a-n}});return{period:`${e} Days`,startDate:new Date(i).toLocaleDateString(),endDate:new Date(n).toLocaleDateString(),totalIn:o,totalOut:l,netBalance:u,avgBalance:s,dayGroups:d}},exportDataJSON:function(){const e={version:"1.0.0",timestamp:Date.now(),dailyLimit:f.value,categories:c.value,records:t.value};return JSON.stringify(e)},importDataJSON:function(e){try{const a=JSON.parse(e);if(!a.records||!Array.isArray(a.records)||!a.categories)throw new Error("Invalid Data Format");return t.value=a.records,c.value=a.categories,a.dailyLimit&&(f.value=a.dailyLimit),S(),I(),n(s,f.value),!0}catch(a){return console.error("Import Failed:",a),!1}},clearAllData:function(){t.value=[],c.value=[...d],f.value=2e3,i(l),i(u),i(s),I()}}}),f=(t,e)=>{const a=t.__vccOpts||t;for(const[n,i]of e)a[n]=i;return a};export{c as M,f as _,p as u};
